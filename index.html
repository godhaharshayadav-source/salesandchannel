<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ViewSonic Executive Dashboard - SBR 1</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .tab-content { display: none; opacity: 0; transition: opacity 0.3s ease-in-out; }
        .tab-content.active { display: block; opacity: 1; }
        .nav-btn.active { background-color: #b91c1c; color: white; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Custom Range Slider */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #b91c1c; cursor: pointer; margin-top: -6px; box-shadow: 0 0 0 2px white, 0 0 4px rgba(0,0,0,0.3); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e5e7eb; border-radius: 2px; }
        
        .strategy-card { transition: all 0.3s ease; }
        .strategy-card:hover { transform: translateY(-2px); }
        .strategy-card.selected { border-color: #b91c1c; background-color: white; transform: scale(1.02); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        .partner-card { transition: all 0.2s; }
        .partner-card.active { border-left-color: #b91c1c; background-color: #fef2f2; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen pb-12">

    <!-- HEADER -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-7xl mx-auto px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-4">
                <div class="w-12 h-12 bg-red-700 rounded text-white flex items-center justify-center font-bold text-xl tracking-tighter shadow-lg">VS</div>
                <div>
                    <h1 class="text-2xl font-black tracking-tight text-gray-900">SBR 1 <span class="text-red-700">STRATEGY CONSOLE</span></h1>
                    <p class="text-xs text-gray-500 tracking-widest uppercase">Target: 16.36M AED // UAE Enterprise</p>
                </div>
            </div>
            <nav class="flex gap-2 bg-gray-100 p-1 rounded-lg overflow-x-auto w-full md:w-auto">
                <button onclick="switchTab('market')" id="btn-market" class="nav-btn active px-4 py-2 text-xs font-bold uppercase rounded-md transition-all text-gray-500 hover:text-red-700 hover:bg-white flex-1 md:flex-none text-center">Market</button>
                <button onclick="switchTab('strategy')" id="btn-strategy" class="nav-btn px-4 py-2 text-xs font-bold uppercase rounded-md transition-all text-gray-500 hover:text-red-700 hover:bg-white flex-1 md:flex-none text-center">Strategy</button>
                <button onclick="switchTab('partners')" id="btn-partners" class="nav-btn px-4 py-2 text-xs font-bold uppercase rounded-md transition-all text-gray-500 hover:text-red-700 hover:bg-white flex-1 md:flex-none text-center">Partners</button>
                <button onclick="switchTab('simulation')" id="btn-simulation" class="nav-btn px-4 py-2 text-xs font-bold uppercase rounded-md transition-all text-gray-500 hover:text-red-700 hover:bg-white flex-1 md:flex-none text-center">Simulation</button>
                <button onclick="switchTab('expansion')" id="btn-expansion" class="nav-btn px-4 py-2 text-xs font-bold uppercase rounded-md transition-all text-gray-500 hover:text-red-700 hover:bg-white flex-1 md:flex-none text-center">Expansion</button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-6 py-8">

        <!-- TAB 1: MARKET ANALYSIS -->
        <div id="market" class="tab-content active space-y-8">
            <!-- KPIs -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- TAM -->
                <div class="bg-white border-l-4 border-red-700 p-6 rounded shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow">
                    <i data-lucide="globe" class="absolute top-4 right-4 w-16 h-16 text-red-700 opacity-5 group-hover:scale-110 transition-transform"></i>
                    <h3 class="text-gray-500 text-xs uppercase font-bold mb-1">Total Addressable (TAM)</h3>
                    <p class="text-3xl font-black text-gray-900">AED 91.37M</p>
                    <p class="text-red-700 text-xs mt-2 font-bold">Total Pipeline Value</p>
                </div>
                <!-- SAM -->
                <div class="bg-white border-l-4 border-red-700 p-6 rounded shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow">
                    <i data-lucide="target" class="absolute top-4 right-4 w-16 h-16 text-red-700 opacity-5 group-hover:scale-110 transition-transform"></i>
                    <h3 class="text-gray-500 text-xs uppercase font-bold mb-1">Serviceable Market (SAM)</h3>
                    <p class="text-3xl font-black text-gray-900">AED 58.44M</p>
                    <p class="text-red-700 text-xs mt-2 font-bold">Execution + On Hold</p>
                </div>
                <!-- SOM -->
                <div class="bg-white border-l-4 border-red-700 p-6 rounded shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow">
                    <i data-lucide="award" class="absolute top-4 right-4 w-16 h-16 text-red-700 opacity-5 group-hover:scale-110 transition-transform"></i>
                    <h3 class="text-gray-500 text-xs uppercase font-bold mb-1">Obtainable (SOM)</h3>
                    <p class="text-3xl font-black text-gray-900">AED 16.36M</p>
                    <p class="text-red-700 text-xs mt-2 font-bold">Target: 28% Share</p>
                </div>
            </div>

            <!-- Charts -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Funnel Chart -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-sm font-bold mb-6 text-gray-800 flex items-center gap-2">
                        <i data-lucide="filter" class="text-red-700 w-4 h-4"></i> PIPELINE CONVERSION
                    </h3>
                    <div class="h-64 relative">
                        <canvas id="funnelChart"></canvas>
                    </div>
                    <div class="mt-4 text-xs text-gray-500 text-center bg-gray-50 p-2 rounded">
                        <strong>Strategy Note:</strong> SAM filter aggressively targets "On-Hold" projects assuming 50% resumption (Slide 9).
                    </div>
                </div>

                <!-- Interactive Sector Chart -->
                <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-sm font-bold text-gray-800 flex items-center gap-2">
                            <i data-lucide="pie-chart" class="text-red-700 w-4 h-4"></i> SECTOR VALUE
                        </h3>
                        <div class="flex bg-gray-100 p-1 rounded">
                            <button onclick="updateSectorChart('TAM')" id="btn-sec-tam" class="px-3 py-1 text-[10px] font-bold rounded transition-all bg-white shadow text-red-700">TAM</button>
                            <button onclick="updateSectorChart('SAM')" id="btn-sec-sam" class="px-3 py-1 text-[10px] font-bold rounded transition-all text-gray-500">SAM</button>
                        </div>
                    </div>
                    
                    <div class="h-48 relative">
                        <canvas id="sectorChart"></canvas>
                    </div>

                    <!-- Dynamic Sector Insight -->
                    <div id="sector-detail-card" class="mt-4 p-4 bg-red-50 rounded border-l-4 border-red-700 transition-all">
                        <div class="flex items-start gap-3">
                            <i data-lucide="info" class="w-5 h-5 text-red-700 mt-0.5"></i>
                            <div>
                                <h4 id="sec-title" class="text-sm font-bold text-gray-900">Hospitality (23.25M)</h4>
                                <p id="sec-desc" class="text-xs text-gray-600 mt-1">Primary Value Driver. High volume of 5-star hotel retrofits post-COVID. Target with Scientechnic.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 2: STRATEGY -->
        <div id="strategy" class="tab-content space-y-6">
            <div class="bg-gradient-to-r from-red-900 to-red-700 text-white p-8 rounded-xl shadow-lg flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-2xl font-black mb-2">DISTRIBUTION STRATEGY SELECTOR</h2>
                    <p class="opacity-90 text-sm">Based on Slide 7 analysis. Click cards to view Strategic Rationale.</p>
                </div>
                <i data-lucide="briefcase" class="hidden md:block w-12 h-12 opacity-50"></i>
            </div>

            <!-- Strategy Cards -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Intensive -->
                <button onclick="selectStrategy('intensive')" id="card-intensive" class="strategy-card text-left p-6 rounded-xl border-2 border-gray-200 bg-gray-50 opacity-70">
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-black text-lg text-gray-500">Intensive</h4>
                        <i data-lucide="x-circle" class="w-6 h-6 text-gray-300"></i>
                    </div>
                    <div class="text-xs font-bold uppercase mb-2 text-gray-400">Rejected</div>
                    <p class="text-sm text-gray-600 leading-relaxed">Selling via mass retail (e.g., Carrefour).</p>
                </button>

                <!-- Exclusive -->
                <button onclick="selectStrategy('exclusive')" id="card-exclusive" class="strategy-card text-left p-6 rounded-xl border-2 border-gray-200 bg-gray-50 opacity-70">
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-black text-lg text-gray-500">Exclusive</h4>
                        <i data-lucide="x-circle" class="w-6 h-6 text-gray-300"></i>
                    </div>
                    <div class="text-xs font-bold uppercase mb-2 text-gray-400">Rejected</div>
                    <p class="text-sm text-gray-600 leading-relaxed">Single partner model.</p>
                </button>

                <!-- Hybrid -->
                <button onclick="selectStrategy('hybrid')" id="card-hybrid" class="strategy-card selected text-left p-6 rounded-xl border-2 border-red-700 bg-white shadow-xl scale-105">
                    <div class="flex justify-between items-start mb-4">
                        <h4 class="font-black text-lg text-gray-900">Selective Hybrid</h4>
                        <i data-lucide="check-circle" class="w-6 h-6 text-red-700"></i>
                    </div>
                    <div class="text-xs font-bold uppercase mb-2 text-red-700">Selected</div>
                    <p class="text-sm text-gray-600 leading-relaxed">Direct for Strategic Accounts + Vertical Specialists.</p>
                </button>
            </div>

            <!-- Dynamic Details -->
            <div id="strategy-detail" class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                <!-- Content injected via JS -->
            </div>
        </div>

        <!-- TAB 3: PARTNERS -->
        <div id="partners" class="tab-content space-y-6">
            <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100">
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Sidebar: Vertical Selector -->
                    <div class="w-full md:w-1/3 space-y-2">
                        <h3 class="text-sm font-bold text-gray-900 mb-4 flex items-center gap-2">
                            <i data-lucide="search" class="w-4 h-4 text-red-700"></i> FIND PARTNER BY VERTICAL
                        </h3>
                        <button onclick="showPartner('govt')" id="pt-btn-govt" class="partner-card w-full text-left p-3 rounded border border-gray-200 text-sm font-semibold hover:bg-gray-50 text-gray-600 active">Government & Oil/Gas</button>
                        <button onclick="showPartner('edu')" id="pt-btn-edu" class="partner-card w-full text-left p-3 rounded border border-gray-200 text-sm font-semibold hover:bg-gray-50 text-gray-600">Education (K-12 & Higher)</button>
                        <button onclick="showPartner('hosp')" id="pt-btn-hosp" class="partner-card w-full text-left p-3 rounded border border-gray-200 text-sm font-semibold hover:bg-gray-50 text-gray-600">Hospitality & Leisure</button>
                        <button onclick="showPartner('logistics')" id="pt-btn-logistics" class="partner-card w-full text-left p-3 rounded border border-gray-200 text-sm font-semibold hover:bg-gray-50 text-gray-600">Logistics & Credit</button>
                    </div>

                    <!-- Content: Partner Details -->
                    <div class="w-full md:w-2/3 bg-gray-50 rounded-xl p-6 border border-gray-200 flex flex-col justify-center">
                        <div id="partner-display">
                            <!-- Injected by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Value Chain Visualization -->
            <div class="bg-white p-8 rounded-xl shadow-sm border border-gray-100 text-center">
                <h3 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-6">Execution Value Chain</h3>
                <div class="flex flex-col md:flex-row justify-center items-center gap-4 text-xs font-bold text-gray-600">
                    <div class="px-4 py-2 bg-red-100 text-red-800 rounded">ViewSonic (Factory)</div>
                    <i data-lucide="arrow-right" class="w-4 h-4 text-gray-300"></i>
                    <div class="px-4 py-2 bg-gray-100 rounded">Distributor (Ingram)</div>
                    <i data-lucide="arrow-right" class="w-4 h-4 text-gray-300"></i>
                    <div class="px-4 py-2 bg-gray-100 rounded">SI (Alpha Data)</div>
                    <i data-lucide="arrow-right" class="w-4 h-4 text-gray-300"></i>
                    <div class="px-4 py-2 bg-gray-900 text-white rounded">End User (Client)</div>
                </div>
            </div>
        </div>

        <!-- TAB 4: SIMULATION -->
        <div id="simulation" class="tab-content space-y-6">
            <div class="bg-gray-900 text-white p-6 rounded-lg flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <i data-lucide="flask-conical" class="text-red-500 w-12 h-12"></i>
                    <div>
                        <h2 class="text-2xl font-black text-white mb-1">WAR GAMING CONSOLE</h2>
                        <p class="text-gray-400 text-sm">Test Slide 9 Assumptions & Risks.</p>
                    </div>
                </div>
                <!-- Scenario Presets -->
                <div class="flex gap-2">
                    <button onclick="setScenario('base')" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-xs font-bold">Base Case</button>
                    <button onclick="setScenario('optimistic')" class="px-3 py-1 bg-green-900 hover:bg-green-800 text-green-100 rounded text-xs font-bold">Optimistic</button>
                    <button onclick="setScenario('pricewar')" class="px-3 py-1 bg-red-900 hover:bg-red-800 text-red-100 rounded text-xs font-bold">⚠️ Price War</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Slider 1 -->
                <div class="bg-white p-6 rounded shadow border border-gray-100">
                    <h4 class="font-bold text-gray-900 mb-6 flex items-center gap-2"><i data-lucide="activity" class="text-blue-600 w-4 h-4"></i> ON-HOLD RESUMPTION</h4>
                    <div class="mb-4">
                        <div class="flex justify-between text-xs font-bold mb-2"><span>0%</span><span id="resump-val" class="text-blue-600">50%</span><span>100%</span></div>
                        <input type="range" id="slider-resump" min="0" max="100" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb accent-blue-600">
                    </div>
                    <p class="text-xs text-gray-500">Assumption: % of stalled projects that restart in Q1/Q2.</p>
                </div>

                <!-- Slider 2 -->
                <div class="bg-white p-6 rounded shadow border border-gray-100">
                    <h4 class="font-bold text-gray-900 mb-6 flex items-center gap-2"><i data-lucide="alert-triangle" class="text-yellow-600 w-4 h-4"></i> EDUCATION DISCOUNT</h4>
                    <div class="mb-4">
                        <div class="flex justify-between text-xs font-bold mb-2"><span>0%</span><span id="discount-val" class="text-yellow-600">10%</span><span>30%</span></div>
                        <input type="range" id="slider-discount" min="0" max="30" value="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider-thumb accent-yellow-600">
                    </div>
                    <p class="text-xs text-gray-500">Assumption: Volume discount demanded by Ministry of Edu.</p>
                </div>

                <!-- Result -->
                <div class="bg-gray-800 p-6 rounded shadow text-center flex flex-col justify-center relative overflow-hidden">
                    <div class="absolute inset-0 bg-red-900 opacity-20"></div>
                    <h4 class="text-gray-400 text-xs font-bold uppercase tracking-widest mb-2 relative z-10">Adjusted SOM Target</h4>
                    <p id="sim-result" class="text-4xl font-black text-white mb-2 relative z-10">AED 16.36M</p>
                    <div id="sim-status" class="text-xs relative z-10 text-green-400 font-bold flex justify-center items-center gap-1">
                        <i data-lucide="trending-up" class="w-3 h-3"></i> On Track
                    </div>
                </div>
            </div>
            
            <!-- Risk Alert -->
            <div id="risk-alert" class="hidden bg-red-50 border-l-4 border-red-500 p-4 rounded animate-pulse">
                <div class="flex gap-3">
                    <i data-lucide="alert-octagon" class="text-red-600"></i>
                    <div>
                        <h4 class="text-red-800 font-bold text-sm">CRITICAL WARNING</h4>
                        <p class="text-red-600 text-xs">Revenue drops below 14M. Trigger "Contingency Plan B" (Shift marketing spend to Government/Stable sectors).</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB 5: EXPANSION -->
        <div id="expansion" class="tab-content space-y-6">
            <div class="bg-gradient-to-r from-blue-900 to-blue-700 text-white p-8 rounded-xl shadow-lg flex justify-between items-center">
                <div>
                    <h2 class="text-2xl font-black mb-2">REGIONAL EXPANSION MATRIX</h2>
                    <p class="opacity-90 text-sm">Strategic Roadmap: Beyond UAE (GCC Growth Plan).</p>
                </div>
                <i data-lucide="plane" class="hidden md:block w-12 h-12 opacity-50"></i>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Scatter Chart -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                    <h3 class="text-sm font-bold mb-4 text-gray-800 flex items-center gap-2">
                        <i data-lucide="land-plot" class="text-blue-700 w-4 h-4"></i> GCC MARKET ATTRACTIVENESS
                    </h3>
                    <div class="h-80 relative">
                        <canvas id="expansionChart"></canvas>
                    </div>
                </div>

                <!-- Launchpad -->
                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col justify-between">
                    <div>
                        <h3 class="text-sm font-bold mb-4 text-gray-800 flex items-center gap-2">
                            <i data-lucide="rocket" class="text-blue-700 w-4 h-4"></i> EXPANSION LAUNCHPAD
                        </h3>
                        <div id="country-list" class="space-y-3">
                            <!-- Country items injected by JS -->
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-100">
                        <div class="flex justify-between items-end">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">Regional TAM Potential</span>
                            <span id="region-tam" class="text-3xl font-black text-blue-900">AED 91M</span>
                        </div>
                        <div class="w-full bg-gray-100 rounded-full h-2 mt-2">
                            <div id="tam-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: 20%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <!-- JAVASCRIPT LOGIC -->
    <script>
        // Init Icons
        lucide.createIcons();

        // --- DATA ---
        const sectorDataTAM = { labels: ['Hospitality', 'Mixed-Use', 'Education', 'Commercial', 'Healthcare'], data: [23.25, 22.17, 20.88, 19.14, 5.93] };
        const sectorDataSAM = { labels: ['Hospitality', 'Mixed-Use', 'Education', 'Commercial', 'Healthcare'], data: [14.90, 14.19, 13.32, 12.25, 3.78] };
        
        const sectorInsights = {
            'Hospitality': "Top Value Driver. Focus: Conference Centers & 5-Star Retrofits. Key Partner: Scientechnic.",
            'Mixed-Use': "High Prestige. Focus: Smart Building Integration (Business Bay). Key Partner: Alpha Data.",
            'Education': "Volume Driver. Focus: Universities & Private Schools. Needs 10% Discount.",
            'Commercial': "Steady Growth. Focus: Corporate HQs (DIFC). Direct Sales Priority.",
            'Healthcare': "Niche High Margin. Focus: Training Hospitals. Low Volume, High Spec."
        };

        const partnersData = {
            'govt': { name: "Alpha Data", role: "System Integrator", desc: "The #1 SI for Abu Dhabi Govt & Oil/Gas. Holds MSA for ADNOC.", icon: "briefcase", color: "text-blue-600" },
            'edu': { name: "Almoe AV", role: "Specialist SI", desc: "Deep connections with Ministry of Education. Strong in K-12 install base.", icon: "book-open", color: "text-yellow-600" },
            'hosp': { name: "Scientechnic", role: "System Integrator", desc: "Dominates hotel lighting & AV fit-outs. Key for Hospitality sector.", icon: "coffee", color: "text-purple-600" },
            'logistics': { name: "Ingram Micro", role: "Distributor", desc: "Regional logistics powerhouse. Provides credit lines and warehousing.", icon: "truck", color: "text-red-600" }
        };

        const expansionData = [
            { id: 'ksa', name: 'Saudi Arabia', x: 40, y: 250, strategy: 'Direct Subsidiary', status: 'Pending', tam: 250 },
            { id: 'uae', name: 'UAE (Base)', x: 90, y: 91, strategy: 'Hybrid Model', status: 'Active', tam: 91 },
            { id: 'qatar', name: 'Qatar', x: 70, y: 60, strategy: 'Exclusive Partner', status: 'Pending', tam: 60 },
            { id: 'kuwait', name: 'Kuwait', x: 50, y: 45, strategy: 'Distributor Led', status: 'Pending', tam: 45 },
            { id: 'oman', name: 'Oman', x: 80, y: 30, strategy: 'Distributor Led', status: 'Pending', tam: 30 }
        ];
        let activeCountries = ['uae'];

        // --- CHART INSTANCES ---
        let funnelChartInst = null;
        let sectorChartInst = null;
        let expansionChartInst = null;
        let strategyChartInst = null; // Area chart inside strategy detail

        // --- TAB SWITCHING ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.nav-btn').forEach(el => {
                el.classList.remove('active', 'bg-red-700', 'text-white');
                el.classList.add('text-gray-500', 'hover:text-red-700');
            });
            
            document.getElementById(tabId).classList.add('active');
            const btn = document.getElementById('btn-' + tabId);
            btn.classList.add('active', 'bg-red-700', 'text-white');
            btn.classList.remove('text-gray-500', 'hover:text-red-700');

            if (tabId === 'market' && !funnelChartInst) initMarketCharts();
            if (tabId === 'strategy') renderStrategyDetail('hybrid');
            if (tabId === 'partners') showPartner('govt');
            if (tabId === 'expansion' && !expansionChartInst) initExpansionCharts();
        }

        // --- MARKET CHARTS ---
        function initMarketCharts() {
            const ctxFunnel = document.getElementById('funnelChart').getContext('2d');
            funnelChartInst = new Chart(ctxFunnel, {
                type: 'bar',
                data: {
                    labels: ['TAM (Total)', 'SAM (Active)', 'SOM (Target)'],
                    datasets: [{
                        label: 'Value (AED M)',
                        data: [91.37, 58.44, 16.36],
                        backgroundColor: ['#64748b', '#cf102d', '#000000'],
                        barPercentage: 0.6
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { grid: { display: false } } }
                }
            });

            const ctxSector = document.getElementById('sectorChart').getContext('2d');
            sectorChartInst = new Chart(ctxSector, {
                type: 'bar',
                data: {
                    labels: sectorDataTAM.labels,
                    datasets: [{
                        label: 'Value (AED M)',
                        data: sectorDataTAM.data,
                        backgroundColor: ['#cf102d', '#800a1c', '#333333', '#666666', '#999999'],
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const label = sectorChartInst.data.labels[index];
                            const value = sectorChartInst.data.datasets[0].data[index];
                            document.getElementById('sec-title').innerText = `${label} (${value}M)`;
                            document.getElementById('sec-desc').innerText = sectorInsights[label];
                        }
                    },
                    scales: { x: { grid: { display: true } }, y: { grid: { display: false } } }
                }
            });
        }

        function updateSectorChart(type) {
            document.getElementById('btn-sec-tam').className = type === 'TAM' ? "px-3 py-1 text-[10px] font-bold rounded transition-all bg-white shadow text-red-700" : "px-3 py-1 text-[10px] font-bold rounded transition-all text-gray-500";
            document.getElementById('btn-sec-sam').className = type === 'SAM' ? "px-3 py-1 text-[10px] font-bold rounded transition-all bg-white shadow text-red-700" : "px-3 py-1 text-[10px] font-bold rounded transition-all text-gray-500";
            
            const data = type === 'TAM' ? sectorDataTAM.data : sectorDataSAM.data;
            sectorChartInst.data.datasets[0].data = data;
            sectorChartInst.update();
        }

        // --- STRATEGY LOGIC ---
        const strategyContent = {
            hybrid: { title: "WHY SELECTIVE HYBRID?", icon: "check-circle", color: "text-green-600", points: ["<strong>Direct Touch:</strong> Essential for Top 50 Accounts & Govt.", "<strong>Vertical Specialization:</strong> Ed-Tech partners differ from Hospitality AV pros."] },
            intensive: { title: "WHY WE REJECTED THIS:", icon: "alert-triangle", color: "text-yellow-500", points: ["<strong>Strategic Risk:</strong> Selling IFP7550 in mass retail destroys brand equity.", "Corporate buyers require SLAs retail clerks cannot provide."] },
            exclusive: { title: "WHY WE REJECTED THIS:", icon: "alert-triangle", color: "text-yellow-500", points: ["<strong>Strategic Risk:</strong> The UAE market is siloed.", "A partner strong in Education likely has zero access to Dubai Hospitality."] }
        };

        function selectStrategy(id) {
            document.querySelectorAll('.strategy-card').forEach(el => {
                el.classList.remove('selected', 'border-red-700', 'bg-white', 'shadow-xl', 'scale-105');
                el.classList.add('border-gray-200', 'bg-gray-50', 'opacity-70');
                el.querySelector('h4').classList.remove('text-gray-900'); el.querySelector('h4').classList.add('text-gray-500');
                el.querySelector('.text-xs').classList.remove('text-red-700'); el.querySelector('.text-xs').classList.add('text-gray-400');
                const icon = el.querySelector('i'); if(icon) { icon.classList.remove('text-red-700'); icon.classList.add('text-gray-300'); }
            });

            const activeCard = document.getElementById('card-' + id);
            activeCard.classList.remove('border-gray-200', 'bg-gray-50', 'opacity-70');
            activeCard.classList.add('selected', 'border-red-700', 'bg-white', 'shadow-xl', 'scale-105');
            activeCard.querySelector('h4').classList.remove('text-gray-500'); activeCard.querySelector('h4').classList.add('text-gray-900');
            if(id === 'hybrid') {
                activeCard.querySelector('.text-xs').classList.remove('text-gray-400'); activeCard.querySelector('.text-xs').classList.add('text-red-700');
                activeCard.querySelector('i').classList.remove('text-gray-300'); activeCard.querySelector('i').classList.add('text-red-700');
            }
            renderStrategyDetail(id);
        }

        function renderStrategyDetail(id) {
            const data = strategyContent[id];
            const detailDiv = document.getElementById('strategy-detail');
            let chartHtml = id === 'hybrid' ? `<div class="mt-4"><h3 class="text-sm font-bold text-gray-500 mb-2">REVENUE TRAJECTORY</h3><div class="h-40 relative"><canvas id="strategyChart"></canvas></div></div>` : '';

            detailDiv.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-${id === 'hybrid' ? '2' : '1'} gap-8">
                    <div>
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2"><i data-lucide="${data.icon}" class="${data.color} w-5 h-5"></i> ${data.title}</h3>
                        <ul class="space-y-3 text-sm text-gray-600">${data.points.map(p => `<li class="flex items-start gap-2"><span class="w-1.5 h-1.5 bg-red-700 rounded-full mt-1.5"></span><span>${p}</span></li>`).join('')}</ul>
                    </div>
                    ${chartHtml}
                </div>
            `;
            lucide.createIcons();
            if(id === 'hybrid') {
                new Chart(document.getElementById('strategyChart').getContext('2d'), {
                    type: 'line',
                    data: { labels: Array.from({length: 24}, (_, i) => `M${i+1}`), datasets: [{ label: 'Sales', data: Array.from({length: 24}, (_, i) => Math.min(16.36, ((i < 6) ? 0.2 : (i < 12) ? 0.6 : 0.9) * (i+1))), borderColor: '#cf102d', backgroundColor: 'rgba(207, 16, 45, 0.1)', fill: true, tension: 0.4 }] },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } } } }
                });
            }
        }

        // --- PARTNERS LOGIC ---
        function showPartner(id) {
            document.querySelectorAll('.partner-card').forEach(el => el.classList.remove('active', 'border-l-4', 'bg-red-50'));
            document.getElementById('pt-btn-' + id).classList.add('active', 'border-l-4', 'bg-red-50');
            
            const p = partnersData[id];
            document.getElementById('partner-display').innerHTML = `
                <div class="flex items-center gap-4 mb-4">
                    <div class="p-3 bg-white rounded-full shadow-sm"><i data-lucide="${p.icon}" class="${p.color} w-8 h-8"></i></div>
                    <div>
                        <h2 class="text-2xl font-black text-gray-900">${p.name}</h2>
                        <div class="text-xs font-bold uppercase tracking-widest text-gray-500">${p.role}</div>
                    </div>
                </div>
                <p class="text-gray-600 text-sm leading-relaxed">${p.desc}</p>
                <div class="mt-6 flex gap-2">
                    <button class="px-4 py-2 bg-gray-900 text-white text-xs font-bold rounded hover:bg-gray-800">View Contract</button>
                    <button class="px-4 py-2 bg-white border border-gray-300 text-gray-600 text-xs font-bold rounded hover:bg-gray-50">Contact Rep</button>
                </div>
            `;
            lucide.createIcons();
        }

        // --- SIMULATION LOGIC ---
        const sliderResump = document.getElementById('slider-resump');
        const sliderDiscount = document.getElementById('slider-discount');
        
        function setScenario(type) {
            if(type === 'base') { sliderResump.value = 50; sliderDiscount.value = 10; }
            if(type === 'optimistic') { sliderResump.value = 80; sliderDiscount.value = 5; }
            if(type === 'pricewar') { sliderResump.value = 30; sliderDiscount.value = 25; }
            updateSimulation();
        }

        function updateSimulation() {
            const resumptionRate = parseInt(sliderResump.value);
            const eduDiscount = parseInt(sliderDiscount.value);
            
            document.getElementById('resump-val').innerText = resumptionRate + '%';
            document.getElementById('discount-val').innerText = eduDiscount + '%';

            const baseSAM = 58.44;
            const executionPortion = baseSAM * 0.6;
            const onHoldPortion = baseSAM * 0.4;
            const adjustedOnHold = onHoldPortion * (resumptionRate / 50); 
            const adjustedSAM = executionPortion + adjustedOnHold;
            
            let rawSOM = adjustedSAM * 0.28;
            const eduShare = 0.23;
            const discountImpact = (eduDiscount - 10) / 100; 
            const revenueLoss = rawSOM * eduShare * discountImpact;
            
            const finalVal = (rawSOM - revenueLoss).toFixed(2);
            document.getElementById('sim-result').innerText = `AED ${finalVal}M`;

            const statusEl = document.getElementById('sim-status');
            const alertEl = document.getElementById('risk-alert');
            
            if (finalVal < 14) {
                statusEl.className = "text-xs relative z-10 text-red-400 font-bold flex justify-center items-center gap-1";
                statusEl.innerHTML = '<i data-lucide="trending-down" class="w-3 h-3"></i> CRITICAL';
                alertEl.classList.remove('hidden');
            } else if (finalVal < 16.36) {
                statusEl.className = "text-xs relative z-10 text-yellow-500 font-bold flex justify-center items-center gap-1";
                statusEl.innerHTML = '<i data-lucide="minus" class="w-3 h-3"></i> Below Target';
                alertEl.classList.add('hidden');
            } else {
                statusEl.className = "text-xs relative z-10 text-green-400 font-bold flex justify-center items-center gap-1";
                statusEl.innerHTML = '<i data-lucide="trending-up" class="w-3 h-3"></i> On Track';
                alertEl.classList.add('hidden');
            }
            lucide.createIcons();
        }

        sliderResump.addEventListener('input', updateSimulation);
        sliderDiscount.addEventListener('input', updateSimulation);

        // --- EXPANSION LOGIC ---
        function initExpansionCharts() {
            const ctxExp = document.getElementById('expansionChart').getContext('2d');
            expansionChartInst = new Chart(ctxExp, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Countries',
                        data: expansionData.map(c => ({x: c.x, y: c.y, name: c.name})),
                        backgroundColor: (ctx) => {
                            const val = ctx.raw?.y;
                            return val > 100 ? '#22c55e' : val > 90 ? '#cf102d' : val > 50 ? '#3b82f6' : '#eab308';
                        },
                        pointRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { title: { display: true, text: 'Ease of Entry (%)' }, min: 0, max: 100 },
                        y: { title: { display: true, text: 'TAM (AED M)' }, min: 0, max: 300 }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: (ctx) => `${ctx.raw.name}: ${ctx.raw.y}M TAM`
                            }
                        },
                        legend: { display: false }
                    }
                }
            });
            renderCountryList();
        }

        function renderCountryList() {
            const list = document.getElementById('country-list');
            list.innerHTML = expansionData.map(c => {
                const isActive = activeCountries.includes(c.id);
                return `
                    <div class="flex justify-between items-center p-3 rounded border-l-4 transition-all ${isActive ? 'bg-gray-50 border-green-500' : 'bg-white border-gray-200 opacity-60'}">
                        <div>
                            <div class="font-bold text-sm text-gray-900">${c.name}</div>
                            <div class="text-[10px] text-gray-500">${c.strategy}</div>
                        </div>
                        <div class="text-right flex items-center gap-3">
                            <div class="text-xs font-bold text-gray-700">${c.tam}M</div>
                            <button onclick="toggleCountry('${c.id}')" class="p-1 rounded-full ${isActive ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400 hover:bg-green-50 hover:text-green-500'}">
                                <i data-lucide="power" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            lucide.createIcons();
            updateRegionalTAM();
        }

        function toggleCountry(id) {
            if (id === 'uae') return;
            if (activeCountries.includes(id)) {
                activeCountries = activeCountries.filter(c => c !== id);
            } else {
                activeCountries.push(id);
            }
            renderCountryList();
        }

        function updateRegionalTAM() {
            const total = activeCountries.reduce((acc, id) => acc + expansionData.find(c => c.id === id).tam, 0);
            document.getElementById('region-tam').innerText = `AED ${total}M`;
            document.getElementById('tam-progress').style.width = `${(total / 476) * 100}%`;
        }

        // Init
        // Use a timeout to ensure canvas elements are ready, though standard execution flow handles this well usually
        setTimeout(() => {
            initMarketCharts();
        }, 100);
    </script>
</body>
</html>
